---
title: "Example_workflow"
author: "Jacob Strunk"
date: "5/7/2020"
output: html_document
---

load packages - requires devtools package
```{r , eval = FALSE}
devtools::install_github("Jean-Romain/lidR")
devtools::install_github("Jean-Romain/rlas")
devtools::install_github("jacobstrunk001/RSForInvt")

```

#convert dtm raster to fusion .dtm rasters
```{r}
#library(RSForInvt)
RSForInvt::raster2FUSION("D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\DTM\\","D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\DTM_fusion\\")


```


#scan a lidar project
# ?essentially an S3 version of a lidR catalog object stored in a geopackage ?
```{r}
library(lidR)
library(RSForInvt)

 las_info = scan_las(
    project="TN_lidar"
    ,project_year="2018"
    ,proj4_name=NA #"NAD_1983_HARN_StatePlane_Washington_South_FIPS_4601_Feet"
    ,proj4= NA 
    ,dir_las = "D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\lidar_tiles\\"
    ,pattern="[.]la.$"
    ,notes=""
    ,create_polys=T
    ,recursive = T
    ,return=T
    )

#look at results that are returned directly 
las_info$project_id
View(las_info$las_ids) 
plot(las_info$plys) 

#grab the exact same data from geopackage
plys = rgdal::readOGR(dsn = "D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\lidar_tiles\\manage_las\\manage_las.gpkg" , layer = "las_polys" )
con_gpkg = dbConnect(RSQLite::SQLite(), "D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\lidar_tiles\\manage_las\\manage_las.gpkg")
las_ids = dbReadTable(con_gpkg,"las_id")
proj_id = dbReadTable(con_gpkg,"project_id")  

plot(plys)
proj_id
View(las_ids)

```

#build project
```{r }

scan_las("D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\lidar_tiles\\")

RSForInvt::project_create(

  dir_las="D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\lidar_tiles\\"
  ,dir_dtm="D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\Data\\Tennessee\\DTM_fusion\\"
  ,path_gpkg_out="D:\\Box\\VMARS\\Projects\\DAP_evaluation_Meston\\R\\DAP_Lidar_analysis\\RSForInvt/Tennessee_lidar_RSForInvt.gpkg"
  ,layer_plys = "RSForInvt_ply"
  ,layer_config = "RSForInvt_config"
  ,overwrite_project = T
  ,project_dtm="lidar_dtm"
  ,project_las="lidar_las"
  ,dtm_year="2018"
  ,las_year="2018"
  ,do_scan_dtms=T
  ,do_scan_las=T
  ,tile_size=1650
  ,pixel_size=66
  ,xmn=561066,xmx=2805066,ymn=33066,ymx=1551066
  ,proj4 = "+proj=lcc +lat_1=47.33333333333334 +lat_2=45.83333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0001016001 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=us-ft +no_defs"
  ,mask=NA
  ,return=T

)


```


#create gridmetrics output csvs
```{r }



```


#load csvs into sqlite database
```{r }



```


#create rasters from sqlite database
```{r }



```


#create .dtm canopy models
```{r }



```


#merge .dtm canopy models
```{r }



```


#segment individual trees
```{r }



```


#clip plots from lidar
```{r }



```


#summarize plot clips
```{r }



```


#interpolate raster data to plot locations (alternative to plot clips)
```{r }



```

