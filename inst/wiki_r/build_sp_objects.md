# This example demonstrates creation of some sp objects. You can find a more complete demonstration here: <https://mgimond.github.io/Spatial/reading-and-writing-spatial-data-in-r.html>

Dealing with points is relatively easy compared to polygons

``` r
library(raster)
```

    ## Loading required package: sp

``` r
library(sp)
library(rgdal)
```

    ## rgdal: version: 1.5-8, (SVN revision 990)
    ## Geospatial Data Abstraction Library extensions to R successfully loaded
    ## Loaded GDAL runtime: GDAL 3.0.4, released 2020/01/28
    ## Path to GDAL shared files: C:/Users/jstrunk/Documents/R/R-4.0.0/library/rgdal/gdal
    ## GDAL binary built with GEOS: TRUE 
    ## Loaded PROJ runtime: Rel. 6.3.1, February 10th, 2020, [PJ_VERSION: 631]
    ## Path to PROJ shared files: C:/Users/jstrunk/Documents/R/R-4.0.0/library/rgdal/proj
    ## Linking to sp version:1.4-2
    ## To mute warnings of possible GDAL/OSR exportToProj4() degradation,
    ## use options("rgdal_show_exportToProj4_warnings"="none") before loading rgdal.

``` r
library(sf)
```

    ## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1

``` r
# Approach 1
npts = 50
pts_df = data.frame(id=1:npts,x=rnorm(npts)*1000+10e6, y=rnorm(npts)*1000+10e6 , z=rnorm(npts))
coordinates(pts_df) = ~x+y
# Approach 2
npts = 50
pts_df = data.frame(id=1:npts,x=rnorm(npts)*1000+10e6, y=rnorm(npts)*1000+10e6 , z=rnorm(npts))
coordinates(pts_df) = pts_df[,c("x","y")]

pts_df
```

    ## class       : SpatialPointsDataFrame 
    ## features    : 50 
    ## extent      : 9997808, 10001766, 9997784, 10003225  (xmin, xmax, ymin, ymax)
    ## crs         : NA 
    ## variables   : 4
    ## names       : id,                x,                y,                 z 
    ## min values  :  1, 9997808.38717382, 9997783.65775381, -2.25394701252924 
    ## max values  : 50, 10001765.6118827, 10003224.5421251,  1.84680450091114

``` r
plot(pts_df)
```

![](build_sp_objects_files/figure-gfm/unnamed-chunk-1-1.png)<!-- -->

``` r
spplot(pts_df,zcol="z")
```

![](build_sp_objects_files/figure-gfm/unnamed-chunk-1-2.png)<!-- -->

Add projection to pts\_df and write to a shapefile. You will need to
figure out your projection string if you don’t already have it e.g. you
can search here <https://www.spatialreference.org/> I have selected this
projection for this toy example
<https://www.spatialreference.org/ref/epsg/3692/proj4/> See here for
more details on projections in R:
<https://www.nceas.ucsb.edu/sites/default/files/2020-04/OverviewCoordinateReferenceSystems.pdf>

``` r
some_proj4 = "+proj=lcc +lat_1=47.33333333333334 +lat_2=45.83333333333334 +lat_0=45.33333333333334 +lon_0=-120.5 +x_0=500000.0001016001 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +to_meter=0.3048006096012192 +no_defs"

proj4string(pts_df) = some_proj4
```

    ## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum Unknown based on GRS80 ellipsoid in CRS definition,
    ##  but +towgs84= values preserved

``` r
#shapefiles are not great, but they are the most common spatial objects (field name restrictions, file size limitations, proprietary, etc.)
unlink("c:/temp/example_pts.shp",force=T)
rgdal::writeOGR(pts_df,dsn="c:/temp","example_pts1", driver = "ESRI Shapefile", overwrite_layer = T)

#A better option is the open source geopackage (its like an ESRI file geodatabase). Unfortunately rgdal has pretty lousy support for geopackages as far as I can tell, e.g it cannot append. 
if(file.exists("c:/temp/demo_geopackage.gpkg")) try(unlink("c:/temp/demo_geopackage.gpkg",force=T))
rgdal::writeOGR(pts_df,dsn="c:/temp/demo_geopackage.gpkg","example_pts1", driver = "GPKG")

#the sf package does a better job, but you have to convert from sp to sf first... It seems like sf objects are a better data model (basically an R data frame), but most spatial packages in R still use sp objects.
pts_df_sf = sf::st_as_sf(pts_df)

#this add a new layer to the geopackage - not possible with rgdal (for geopackages)
sf::st_write(pts_df_sf,dsn="c:/temp/demo_geopackage.gpkg", "example_pts2", driver="GPKG") 
```

    ## Writing layer `example_pts2' to data source `c:/temp/demo_geopackage.gpkg' using driver `GPKG'
    ## Writing 50 features with 4 fields and geometry type Point.

``` r
#we can even append new rows to an existing object using sf - definitely not possible with rgdal (for geopackages)
pts_df_sf2 = pts_df_sf  
row.names(pts_df_sf2 ) = as.numeric(row.names(pts_df_sf )) + max(as.numeric(row.names(pts_df_sf ))) 
pts_df_sf2$id = pts_df_sf$id + max(pts_df_sf$id)
sf::st_write(pts_df_sf,dsn="c:/temp/demo_geopackage.gpkg", "example_pts2", driver="GPKG",append=T) 
```

    ## Updating layer `example_pts2' to data source `c:/temp/demo_geopackage.gpkg' using driver `GPKG'
    ## Updating existing layer example_pts2
    ## Writing 50 features with 4 fields and geometry type Point.

``` r
#verify that append works
pts_df_sf3 = sf::read_sf(dsn="c:/temp/demo_geopackage.gpkg", "example_pts2")

#notice that pts_df_sf3 has npts*2 records ...
nrow(pts_df_sf)
```

    ## [1] 50

``` r
nrow(pts_df_sf2)
```

    ## [1] 50

``` r
nrow(pts_df_sf3)
```

    ## [1] 100

``` r
knitr::kable(pts_df_sf3)
```

| id |        x |        y |           z | geom                                  |
| -: | -------: | -------: | ----------: | :------------------------------------ |
|  1 | 10000704 |  9999551 |   1.4023785 | c(10000704.3181103, 9999550.92353385) |
|  2 | 10001766 |  9999593 | \-0.8437997 | c(10001765.6118827, 9999593.47182555) |
|  3 |  9999767 |  9999575 |   1.5311384 | c(9999766.58600516, 9999575.49644005) |
|  4 | 10001762 | 10001154 | \-0.9124672 | c(10001761.9738985, 10001154.4469384) |
|  5 |  9999357 | 10000046 | \-1.4876211 | c(9999356.87592129, 10000045.5955343) |
|  6 | 10001714 | 10000298 | \-1.2425364 | c(10001713.8511372, 10000298.2263421) |
|  7 | 10000216 |  9999506 |   1.0347937 | c(10000215.6120513, 9999506.02869403) |
|  8 |  9999525 | 10000540 | \-1.7926012 | c(9999525.37767003, 10000539.9065877) |
|  9 |  9999843 | 10001426 |   0.4390630 | c(9999842.74433879, 10001426.1078594) |
| 10 | 10000015 | 10001504 | \-0.2223706 | c(10000014.6965145, 10001503.518548)  |
| 11 |  9997855 | 10000540 |   0.2556867 | c(9997855.42733892, 10000539.8074931) |
| 12 | 10000326 |  9999520 | \-0.3710288 | c(10000326.1136923, 9999520.27127362) |
| 13 | 10000564 | 10000481 | \-0.8409774 | c(10000563.6587293, 10000481.4439722) |
| 14 |  9999922 |  9999589 |   1.1029327 | c(9999922.29805519, 9999588.60554838) |
| 15 | 10000729 | 10000704 | \-0.6298707 | c(10000728.871271, 10000703.9097621)  |
| 16 | 10001364 |  9999533 | \-0.1102544 | c(10001363.7164533, 9999533.44824117) |
| 17 | 10000021 |  9999622 |   0.3674304 | c(10000021.470032, 9999622.0183352)   |
| 18 |  9998588 | 10000201 |   0.4114879 | c(9998587.66976287, 10000200.766748)  |
| 19 |  9999198 |  9998642 | \-1.3545968 | c(9999197.95250296, 9998642.2631141)  |
| 20 | 10001424 | 10001511 | \-0.2233349 | c(10001423.9982752, 10001511.4352207) |
| 21 |  9999751 |  9999889 |   0.6544538 | c(9999751.39698554, 9999889.32666876) |
| 22 | 10001306 |  9999980 | \-1.5818556 | c(10001306.2043716, 9999980.37998961) |
| 23 | 10000020 |  9999626 |   0.5715329 | c(10000019.900461, 9999625.59356609)  |
| 24 |  9997975 |  9999614 |   1.0525832 | c(9997974.88324155, 9999613.53747358) |
| 25 | 10001089 |  9999097 |   1.8468045 | c(10001089.313244, 9999097.44700029)  |
| 26 | 10001266 | 10000581 |   0.0138334 | c(10001266.3470439, 10000580.9983328) |
| 27 |  9999788 | 10002628 |   0.8209129 | c(9999787.8702157, 10002628.3731993)  |
| 28 | 10001208 |  9999811 | \-0.1559494 | c(10001207.721986, 9999810.86433658)  |
| 29 | 10000010 |  9999733 | \-0.7210560 | c(10000009.6265079, 9999732.98109978) |
| 30 | 10001410 | 10000773 |   0.9679118 | c(10001409.7963877, 10000773.3952802) |
| 31 | 10000043 |  9997784 | \-0.0651733 | c(10000043.069626, 9997783.65775381)  |
| 32 |  9998838 | 10000780 | \-1.2480413 | c(9998838.14260649, 10000779.6889744) |
| 33 | 10000264 | 10000507 | \-1.4329629 | c(10000263.7632876, 10000507.4902312) |
| 34 |  9999005 |  9999705 |   0.3180637 | c(9999005.33131267, 9999705.40951435) |
| 35 |  9999769 |  9999134 | \-1.9315688 | c(9999769.39866534, 9999134.27270236) |
| 36 | 10000740 |  9999741 | \-0.7502551 | c(10000739.8228923, 9999741.00803543) |
| 37 | 10000737 |  9999601 |   0.7831910 | c(10000737.0008614, 9999601.31453628) |
| 38 |  9999682 | 10001377 | \-1.6200016 | c(9999681.94468789, 10001377.1619306) |
| 39 |  9998683 |  9998703 |   1.6455582 | c(9998683.38523516, 9998702.82547206) |
| 40 |  9997808 |  9998625 | \-1.1913051 | c(9997808.38717382, 9998624.64475076) |
| 41 | 10001124 |  9999603 |   0.1418997 | c(10001124.4910493, 9999602.58177572) |
| 42 |  9998540 | 10000173 | \-0.2301453 | c(9998540.04557417, 10000172.6995289) |
| 43 | 10000397 |  9999703 |   1.3639912 | c(10000396.9354221, 9999702.73803337) |
| 44 | 10000665 | 10000368 | \-0.1443896 | c(10000664.8714226, 10000367.7598049) |
| 45 | 10000918 |  9999215 | \-0.4744478 | c(10000917.9497725, 9999215.04932928) |
| 46 | 10000718 | 10001208 | \-1.2787234 | c(10000718.2291257, 10001208.0521331) |
| 47 |  9998507 | 10000279 |   0.4233906 | c(9998506.67853598, 10000279.0621284) |
| 48 |  9998723 | 10001650 | \-2.2539470 | c(9998723.3190762, 10001650.0087686)  |
| 49 | 10001072 | 10003225 | \-0.6208352 | c(10001071.6478767, 10003224.5421251) |
| 50 |  9999695 |  9999370 |   0.5228056 | c(9999695.18813608, 9999370.07673633) |
|  1 | 10000704 |  9999551 |   1.4023785 | c(10000704.3181103, 9999550.92353385) |
|  2 | 10001766 |  9999593 | \-0.8437997 | c(10001765.6118827, 9999593.47182555) |
|  3 |  9999767 |  9999575 |   1.5311384 | c(9999766.58600516, 9999575.49644005) |
|  4 | 10001762 | 10001154 | \-0.9124672 | c(10001761.9738985, 10001154.4469384) |
|  5 |  9999357 | 10000046 | \-1.4876211 | c(9999356.87592129, 10000045.5955343) |
|  6 | 10001714 | 10000298 | \-1.2425364 | c(10001713.8511372, 10000298.2263421) |
|  7 | 10000216 |  9999506 |   1.0347937 | c(10000215.6120513, 9999506.02869403) |
|  8 |  9999525 | 10000540 | \-1.7926012 | c(9999525.37767003, 10000539.9065877) |
|  9 |  9999843 | 10001426 |   0.4390630 | c(9999842.74433879, 10001426.1078594) |
| 10 | 10000015 | 10001504 | \-0.2223706 | c(10000014.6965145, 10001503.518548)  |
| 11 |  9997855 | 10000540 |   0.2556867 | c(9997855.42733892, 10000539.8074931) |
| 12 | 10000326 |  9999520 | \-0.3710288 | c(10000326.1136923, 9999520.27127362) |
| 13 | 10000564 | 10000481 | \-0.8409774 | c(10000563.6587293, 10000481.4439722) |
| 14 |  9999922 |  9999589 |   1.1029327 | c(9999922.29805519, 9999588.60554838) |
| 15 | 10000729 | 10000704 | \-0.6298707 | c(10000728.871271, 10000703.9097621)  |
| 16 | 10001364 |  9999533 | \-0.1102544 | c(10001363.7164533, 9999533.44824117) |
| 17 | 10000021 |  9999622 |   0.3674304 | c(10000021.470032, 9999622.0183352)   |
| 18 |  9998588 | 10000201 |   0.4114879 | c(9998587.66976287, 10000200.766748)  |
| 19 |  9999198 |  9998642 | \-1.3545968 | c(9999197.95250296, 9998642.2631141)  |
| 20 | 10001424 | 10001511 | \-0.2233349 | c(10001423.9982752, 10001511.4352207) |
| 21 |  9999751 |  9999889 |   0.6544538 | c(9999751.39698554, 9999889.32666876) |
| 22 | 10001306 |  9999980 | \-1.5818556 | c(10001306.2043716, 9999980.37998961) |
| 23 | 10000020 |  9999626 |   0.5715329 | c(10000019.900461, 9999625.59356609)  |
| 24 |  9997975 |  9999614 |   1.0525832 | c(9997974.88324155, 9999613.53747358) |
| 25 | 10001089 |  9999097 |   1.8468045 | c(10001089.313244, 9999097.44700029)  |
| 26 | 10001266 | 10000581 |   0.0138334 | c(10001266.3470439, 10000580.9983328) |
| 27 |  9999788 | 10002628 |   0.8209129 | c(9999787.8702157, 10002628.3731993)  |
| 28 | 10001208 |  9999811 | \-0.1559494 | c(10001207.721986, 9999810.86433658)  |
| 29 | 10000010 |  9999733 | \-0.7210560 | c(10000009.6265079, 9999732.98109978) |
| 30 | 10001410 | 10000773 |   0.9679118 | c(10001409.7963877, 10000773.3952802) |
| 31 | 10000043 |  9997784 | \-0.0651733 | c(10000043.069626, 9997783.65775381)  |
| 32 |  9998838 | 10000780 | \-1.2480413 | c(9998838.14260649, 10000779.6889744) |
| 33 | 10000264 | 10000507 | \-1.4329629 | c(10000263.7632876, 10000507.4902312) |
| 34 |  9999005 |  9999705 |   0.3180637 | c(9999005.33131267, 9999705.40951435) |
| 35 |  9999769 |  9999134 | \-1.9315688 | c(9999769.39866534, 9999134.27270236) |
| 36 | 10000740 |  9999741 | \-0.7502551 | c(10000739.8228923, 9999741.00803543) |
| 37 | 10000737 |  9999601 |   0.7831910 | c(10000737.0008614, 9999601.31453628) |
| 38 |  9999682 | 10001377 | \-1.6200016 | c(9999681.94468789, 10001377.1619306) |
| 39 |  9998683 |  9998703 |   1.6455582 | c(9998683.38523516, 9998702.82547206) |
| 40 |  9997808 |  9998625 | \-1.1913051 | c(9997808.38717382, 9998624.64475076) |
| 41 | 10001124 |  9999603 |   0.1418997 | c(10001124.4910493, 9999602.58177572) |
| 42 |  9998540 | 10000173 | \-0.2301453 | c(9998540.04557417, 10000172.6995289) |
| 43 | 10000397 |  9999703 |   1.3639912 | c(10000396.9354221, 9999702.73803337) |
| 44 | 10000665 | 10000368 | \-0.1443896 | c(10000664.8714226, 10000367.7598049) |
| 45 | 10000918 |  9999215 | \-0.4744478 | c(10000917.9497725, 9999215.04932928) |
| 46 | 10000718 | 10001208 | \-1.2787234 | c(10000718.2291257, 10001208.0521331) |
| 47 |  9998507 | 10000279 |   0.4233906 | c(9998506.67853598, 10000279.0621284) |
| 48 |  9998723 | 10001650 | \-2.2539470 | c(9998723.3190762, 10001650.0087686)  |
| 49 | 10001072 | 10003225 | \-0.6208352 | c(10001071.6478767, 10003224.5421251) |
| 50 |  9999695 |  9999370 |   0.5228056 | c(9999695.18813608, 9999370.07673633) |

buffer some Points \>\> polygons

``` r
#bf1 = raster::buffer(pts_df)
```

working with lines

buffer some lines \>\> polygons

working with polygons
